<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Currency Converter</title>
  <style>
    /* ===== Basic styles and theme variables ===== */
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#38bdf8; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: radial-gradient(1200px 800px at 20% -10%, #1e293b, transparent), var(--bg); color: var(--text); }
    .wrap { max-width: 920px; margin: 32px auto; padding: 0 16px; }
    header { display:flex; align-items:center; justify-content:space-between; gap: 12px; margin-bottom: 18px; }
    h1 { font-size: clamp(22px, 3.5vw, 34px); margin:0; letter-spacing: .2px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0)); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
    .converter { padding: 18px; display:grid; grid-template-columns: 1fr; gap: 14px; }
    @media (min-width: 720px) { .converter { grid-template-columns: 2fr 1.2fr 1.2fr 1fr; align-items: end; } }
    label { display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input, select { width: 100%; padding: 12px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.14); background: #0b1220; color: var(--text); outline: none; }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(56,189,248,.2); }
    button { cursor:pointer; border: 1px solid rgba(255,255,255,0.14); background: #0b1220; color: var(--text); padding: 10px 14px; border-radius: 10px; font-weight: 600; }
    button.primary { background: linear-gradient(180deg, #06b6d4, #0284c7); border: none; }
    .result { padding: 16px 18px 18px; border-top: 1px dashed rgba(255,255,255,0.08); display:flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between; }
    .result .big { font-size: clamp(18px, 2.2vw, 24px); font-weight: 700; letter-spacing: .2px; }
    .muted { color: var(--muted); font-size: 13px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { text-align:left; padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.08); }
    th { color: var(--muted); font-weight: 600; }
    .empty { text-align:center; padding: 18px; color: var(--muted); }
    .badge { padding: 2px 8px; border-radius: 999px; background: rgba(56,189,248,.15); color: #67e8f9; font-size: 12px; border: 1px solid rgba(56,189,248,.25); }
    footer { margin-top: 26px; color: var(--muted); font-size: 12px; text-align: center; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header with title and status badge -->
    <header>
      <h1>Currency Converter</h1>
      <span class="badge" id="rateMeta">loading…</span>
    </header>

    <!-- Converter form -->
    <section class="card" aria-label="converter">
      <div class="converter">
        <!-- Amount input -->
        <div>
          <label for="amount">Amount</label>
          <input id="amount" type="number" step="0.01" min="0" value="100" />
        </div>
        <!-- Currency from dropdown -->
        <div>
          <label for="from">From</label>
          <select id="from"></select>
        </div>
        <!-- Currency to dropdown -->
        <div>
          <label for="to">To</label>
          <select id="to"></select>
        </div>
        <!-- Action buttons -->
        <div style="display:flex; gap:10px;">
          <button id="swap" title="Swap currencies">↔ Swap</button>
          <button id="convert" class="primary" title="Convert now">Convert</button>
        </div>
      </div>
      <!-- Conversion result display -->
      <div class="result">
        <div>
          <div class="big" id="resultText">—</div>
          <div class="muted" id="rateText"></div>
        </div>
        <div style="display:flex; gap:10px;">
          <button id="copy">Copy result</button>
          <button id="clearHistory" title="Clear saved history">Clear history</button>
        </div>
      </div>
    </section>

    <!-- Conversion history table -->
    <section class="card grid" aria-label="history">
      <div style="padding:16px 18px; display:flex; justify-content:space-between; align-items:center;">
        <h2 style="margin:0; font-size:18px;">Conversion History</h2>
        <span class="muted" id="historyMeta">local only</span>
      </div>
      <div>
        <table id="historyTable" aria-describedby="historyMeta">
          <thead>
            <tr>
              <th>When</th>
              <th>From</th>
              <th>To</th>
              <th>Rate</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody id="historyBody">
            <tr><td colspan="5" class="empty">No conversions yet.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <footer>
      Powered by Frankfurter.app (no API key). Rates are for demo use only.
    </footer>
  </div>

  <script>
    // ====== Config and constants ======
    const API_BASE = "https://api.frankfurter.app"; // API base URL
    const LS_KEY = "cc_history_v1"; // LocalStorage key for saving history
    const DEFAULTS = { from: "USD", to: "EUR" }; // Default currency pair

    // Cache DOM elements for easy reference
    const els = {
      amount: document.getElementById('amount'),
      from: document.getElementById('from'),
      to: document.getElementById('to'),
      convert: document.getElementById('convert'),
      swap: document.getElementById('swap'),
      copy: document.getElementById('copy'),
      clearHistory: document.getElementById('clearHistory'),
      resultText: document.getElementById('resultText'),
      rateText: document.getElementById('rateText'),
      rateMeta: document.getElementById('rateMeta'),
      historyBody: document.getElementById('historyBody'),
      historyMeta: document.getElementById('historyMeta'),
    };

    // Minimal common currencies as a fallback in case API fails
    const COMMON = {
      "USD": "US Dollar",
      "EUR": "Euro",
      "GBP": "British Pound",
      "JPY": "Japanese Yen",
      "AUD": "Australian Dollar",
      "CAD": "Canadian Dollar",
      "INR": "Indian Rupee",
      "NPR": "Nepalese Rupee",
      "CNY": "Chinese Yuan",
      "CHF": "Swiss Franc",
      "SEK": "Swedish Krona",
      "NZD": "New Zealand Dollar"
    };

    // ====== Fetch available currency symbols ======
    async function fetchSymbols() {
      try {
        const res = await fetch(`${API_BASE}/currencies`);
        if (!res.ok) throw new Error('Failed to load symbols');
        const data = await res.json();
        if (data && typeof data === 'object') {
          return Object.entries(data).reduce((acc, [code, description]) => {
            acc[code] = { description, code };
            return acc;
          }, {});
        }
        throw new Error('Bad symbols response');
      } catch (e) {
        console.warn('Symbols fetch failed, using fallback', e);
        return Object.entries(COMMON).reduce((acc,[code,name])=>{ acc[code] = { description:name, code }; return acc; },{});
      }
    }

    // Populate the currency dropdowns with symbol data
    function populateSelects(symbols) {
      const entries = Object.keys(symbols).sort().map(k => ({ code:k, name: symbols[k].description || k }));
      for (const el of [els.from, els.to]) {
        el.innerHTML = '';
        entries.forEach(({code, name}) => {
          const opt = document.createElement('option');
          opt.value = code; opt.textContent = `${code} — ${name}`;
          el.appendChild(opt);
        });
      }
      els.from.value = DEFAULTS.from in symbols ? DEFAULTS.from : entries[0].code;
      els.to.value = DEFAULTS.to in symbols ? DEFAULTS.to : entries[1].code;
    }

    // Save a conversion to localStorage
    function saveHistory(entry) {
      const arr = JSON.parse(localStorage.getItem(LS_KEY) || '[]');
      arr.unshift(entry);
      localStorage.setItem(LS_KEY, JSON.stringify(arr.slice(0, 20))); // keep last 20
    }

    // Load conversion history from localStorage
    function loadHistory() { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); }

    // Render history table rows
    function renderHistory() {
      const rows = loadHistory();
      if (!rows.length) { els.historyBody.innerHTML = '<tr><td colspan="5" class="empty">No conversions yet.</td></tr>'; return; }
      els.historyBody.innerHTML = rows.map(r => `
        <tr>
          <td>${new Date(r.ts).toLocaleString()}</td>
          <td>${r.amount.toLocaleString()} ${r.from}</td>
          <td>${r.to}</td>
          <td>1 ${r.from} = ${r.rate.toFixed(6)} ${r.to}</td>
          <td><strong>${r.result.toLocaleString(undefined,{maximumFractionDigits:4})} ${r.to}</strong></td>
        </tr>`).join('');
    }

    // Perform currency conversion by calling the API
    async function convert() {
      const amount = parseFloat(els.amount.value);
      const from = els.from.value; const to = els.to.value;
      if (!(amount >= 0)) { alert('Enter a valid amount (≥ 0).'); return; }
      if (from === to) { alert('Choose two different currencies.'); return; }
      try {
        els.rateMeta.textContent = 'fetching…';
        const url = `${API_BASE}/latest?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('Rate request failed');
        const data = await res.json();
        const rate = data && data.rates && typeof data.rates[to] === 'number' ? data.rates[to] : null;
        if (!rate) throw new Error('Unexpected API response');
        const result = amount * rate;
        // Update UI
        els.resultText.textContent = `${amount.toLocaleString()} ${from} → ${result.toLocaleString(undefined,{maximumFractionDigits:4})} ${to}`;
        els.rateText.textContent = `1 ${from} = ${rate.toFixed(6)} ${to} • ${new Date(data.date || Date.now()).toLocaleDateString()}`;
        els.rateMeta.textContent = 'live';
        // Save and render history
        saveHistory({ ts: Date.now(), amount, from, to, rate, result });
        renderHistory();
      } catch (err) {
        console.error(err);
        els.rateMeta.textContent = 'error';
        alert('Conversion failed. Please try again or check your network.');
      }
    }

    // Swap selected currencies
    function swap() {
      const a = els.from.value; els.from.value = els.to.value; els.to.value = a;
    }

    // Copy the result text to clipboard
    function copyResult() {
      const text = els.resultText.textContent.trim();
      if (!text || text === '—') return;
      navigator.clipboard.writeText(text).then(()=>{
        els.copy.textContent = 'Copied!';
        setTimeout(()=> els.copy.textContent = 'Copy result', 1200);
      });
    }

    // Clear all saved history
    function clearHistory() {
      if (!confirm('Clear all saved conversions?')) return;
      localStorage.removeItem(LS_KEY); renderHistory();
    }

    // ====== Initialize app ======
    (async function init(){
      const symbols = await fetchSymbols();
      populateSelects(symbols);
      renderHistory();
      // Attach event listeners
      els.convert.addEventListener('click', convert);
      els.swap.addEventListener('click', () => { swap(); convert(); });
      els.copy.addEventListener('click', copyResult);
      els.clearHistory.addEventListener('click', clearHistory);
      // Pressing Enter triggers conversion
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') convert(); });
      // Perform initial conversion on load
      convert();
    })();
  </script>
</body>
</html>
